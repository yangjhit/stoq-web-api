# 商品分类和模板接口指南
商品分类和商品模板管理的完整指南。

## 目录

1. [概览](#概览)
2. [商品分类管理](#商品分类管理)
3. [商品模板管理](#商品模板管理)
4. [完整API测试流程](#完整api测试流程)
5. [错误处理](#错误处理)
6. [权限控制](#权限控制)
7. [数据关系](#数据关系)

---

## 概览

Stoq API提供了完整的商品分类和模板管理系统,具有以下特性:

- ✅ 为公司创建商品分类
- ✅ 在分类中创建商品模板
- ✅ 支持多张商品图片
- ✅ 完整的商品信息(价格、供应商、条形码等)
- ✅ 基于角色的权限控制(仅ADMIN可操作)
- ✅ 分类名称和模板名称唯一性验证

### 主要端点

#### 商品分类端点

| 方法 | 端点 | 说明 |
|------|------|------|
| POST | `/product-categories` | 创建商品分类 |
| GET | `/product-categories/company/{companyId}` | 获取公司的所有分类 |
| GET | `/product-categories/{id}` | 根据ID获取分类 |
| GET | `/product-categories/my` | 获取我创建的所有分类 |
| PUT | `/product-categories/{id}` | 更新分类信息 |
| DELETE | `/product-categories/{id}` | 删除分类 |

#### 商品模板端点

| 方法 | 端点 | 说明 |
|------|------|------|
| POST | `/product-templates` | 创建商品模板 |
| GET | `/product-templates/category/{categoryId}` | 获取分类的所有模板 |
| GET | `/product-templates/{id}` | 根据ID获取模板 |
| GET | `/product-templates/my` | 获取我创建的所有模板 |
| PUT | `/product-templates/{id}` | 更新模板信息 |
| DELETE | `/product-templates/{id}` | 删除模板 |

---

## 商品分类管理

### 创建商品分类

为公司创建一个新的商品分类。

**权限要求:** ADMIN

**请求:**
```bash
curl -X POST http://localhost:8080/product-categories \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "电子产品",
    "description": "各类电子产品和配件",
    "image": "https://example.com/electronics.jpg",
    "companyId": 1
  }'
```

**请求体:**
```json
{
  "name": "电子产品",
  "description": "各类电子产品和配件",
  "image": "https://example.com/electronics.jpg",
  "companyId": 1
}
```

**字段说明:**

| 字段 | 类型 | 必需 | 说明 |
|------|------|------|------|
| name | String | ✅ | 分类名称(2-200字符,公司内唯一) |
| description | String | ❌ | 分类描述(最多1000字符) |
| image | String | ❌ | 分类图片URL |
| companyId | Long | ✅ | 所属公司ID |

**验证规则:**
- 分类名称长度必须在2-200个字符之间
- 分类名称在同一公司内必须唯一
- 公司必须存在
- 用户必须是该公司的ADMIN

**响应 (201 Created):**
```json
{
  "id": 1,
  "name": "电子产品",
  "description": "各类电子产品和配件",
  "image": "https://example.com/electronics.jpg",
  "companyId": 1,
  "companyName": "示例公司",
  "creatorEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:09:35.079708",
  "updatedAt": "2025-11-16T18:09:35.079712"
}
```

**错误响应 (400 Bad Request):**
```json
{
  "status": 400,
  "message": "Validation failed: Category name must be between 2-200 characters",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

**错误响应 (409 Conflict):**
```json
{
  "status": 409,
  "message": "Category name already exists in this company",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

---

### 获取公司的所有分类

获取指定公司的所有商品分类。

**权限要求:** 公司成员(ADMIN/MANAGER/MEMBER)

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/product-categories/company/1
```

**查询参数:**
- `companyId` (路径参数,必需): 公司ID

**响应 (200 OK):**
```json
[
  {
    "id": 1,
    "name": "电子产品",
    "description": "各类电子产品和配件",
    "image": "https://example.com/electronics.jpg",
    "companyId": 1,
    "companyName": "示例公司",
    "creatorEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:09:35.079708",
    "updatedAt": "2025-11-16T18:09:35.079712"
  },
  {
    "id": 2,
    "name": "服装",
    "description": "衣服和配饰",
    "image": "https://example.com/clothing.jpg",
    "companyId": 1,
    "companyName": "示例公司",
    "creatorEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:09:50.565854",
    "updatedAt": "2025-11-16T18:09:50.565862"
  }
]
```

**错误响应 (404 Not Found):**
```json
{
  "status": 404,
  "message": "Company not found: 1",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

---

### 根据ID获取分类

获取指定ID的商品分类详情。

**权限要求:** 公司成员(ADMIN/MANAGER/MEMBER)

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/product-categories/1
```

**路径参数:**
- `id` (必需): 分类ID

**响应 (200 OK):**
```json
{
  "id": 1,
  "name": "电子产品",
  "description": "各类电子产品和配件",
  "image": "https://example.com/electronics.jpg",
  "companyId": 1,
  "companyName": "示例公司",
  "creatorEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:09:35.079708",
  "updatedAt": "2025-11-16T18:09:35.079712"
}
```

**错误响应 (404 Not Found):**
```json
{
  "status": 404,
  "message": "Product category not found: 1",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

---

### 获取我创建的所有分类

获取当前用户创建的所有商品分类。

**权限要求:** 登录用户

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/product-categories/my
```

**响应 (200 OK):**
```json
[
  {
    "id": 1,
    "name": "电子产品",
    "description": "各类电子产品和配件",
    "image": "https://example.com/electronics.jpg",
    "companyId": 1,
    "companyName": "示例公司",
    "creatorEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:09:35.079708",
    "updatedAt": "2025-11-16T18:09:35.079712"
  }
]
```

---

### 更新分类信息

更新指定ID的商品分类信息。

**权限要求:** ADMIN

**请求:**
```bash
curl -X PUT http://localhost:8080/product-categories/1 \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "电子产品和配件",
    "description": "更新后的描述",
    "image": "https://example.com/electronics-updated.jpg",
    "companyId": 1
  }'
```

**请求体:**
```json
{
  "name": "电子产品和配件",
  "description": "更新后的描述",
  "image": "https://example.com/electronics-updated.jpg",
  "companyId": 1
}
```

**响应 (200 OK):**
```json
{
  "id": 1,
  "name": "电子产品和配件",
  "description": "更新后的描述",
  "image": "https://example.com/electronics-updated.jpg",
  "companyId": 1,
  "companyName": "示例公司",
  "creatorEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:09:35.079708",
  "updatedAt": "2025-11-16T18:10:00.000000"
}
```

---

### 删除分类

删除指定ID的商品分类。

**权限要求:** ADMIN

**请求:**
```bash
curl -X DELETE http://localhost:8080/product-categories/1 \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**路径参数:**
- `id` (必需): 分类ID

**响应 (204 No Content)**

**错误响应 (404 Not Found):**
```json
{
  "status": 404,
  "message": "Product category not found: 1",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

---

## 商品模板管理

### 创建商品模板

在指定分类中创建一个新的商品模板。

**权限要求:** ADMIN

**请求:**
```bash
curl -X POST http://localhost:8080/product-templates \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "iPhone 15 Pro",
    "description": "最新款苹果智能手机",
    "images": [
      "https://example.com/iphone1.jpg",
      "https://example.com/iphone2.jpg"
    ],
    "unit": "件",
    "price": 999.99,
    "currency": "USD",
    "supplier": "Apple Inc",
    "supplierCountry": "USA",
    "barCode": "123456789012",
    "qrCode": "https://example.com/qr.png",
    "categoryId": 1
  }'
```

**请求体:**
```json
{
  "name": "iPhone 15 Pro",
  "description": "最新款苹果智能手机",
  "images": [
    "https://example.com/iphone1.jpg",
    "https://example.com/iphone2.jpg"
  ],
  "unit": "件",
  "price": 999.99,
  "currency": "USD",
  "supplier": "Apple Inc",
  "supplierCountry": "USA",
  "barCode": "123456789012",
  "qrCode": "https://example.com/qr.png",
  "categoryId": 1
}
```

**字段说明:**

| 字段 | 类型 | 必需 | 说明 |
|------|------|------|------|
| name | String | ✅ | 模板名称(2-200字符,分类内唯一) |
| description | String | ❌ | 模板描述(最多1000字符) |
| images | Array[String] | ❌ | 图片URL列表(支持多张) |
| unit | String | ✅ | 单位(1-100字符,如:件、盒、箱) |
| price | BigDecimal | ✅ | 价格(必须大于0) |
| currency | String | ✅ | 货币单位(1-20字符,如:CNY、USD) |
| supplier | String | ✅ | 供应商(2-200字符) |
| supplierCountry | String | ✅ | 供应商所在国家(2-100字符) |
| barCode | String | ❌ | 条形码 |
| qrCode | String | ❌ | 二维码 |
| categoryId | Long | ✅ | 所属分类ID |

**验证规则:**
- 模板名称长度必须在2-200个字符之间
- 模板名称在同一分类内必须唯一
- 价格必须大于0
- 分类必须存在
- 用户必须是该公司的ADMIN

**响应 (201 Created):**
```json
{
  "id": 1,
  "name": "iPhone 15 Pro",
  "description": "最新款苹果智能手机",
  "images": [
    "https://example.com/iphone1.jpg",
    "https://example.com/iphone2.jpg"
  ],
  "unit": "件",
  "price": 999.99,
  "currency": "USD",
  "supplier": "Apple Inc",
  "supplierCountry": "USA",
  "barCode": "123456789012",
  "qrCode": "https://example.com/qr.png",
  "categoryId": 1,
  "categoryName": "电子产品",
  "companyId": 1,
  "companyName": "示例公司",
  "creatorEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:19:14.289823",
  "updatedAt": "2025-11-16T18:19:14.289826"
}
```

**错误响应 (400 Bad Request):**
```json
{
  "status": 400,
  "message": "Validation failed: Price must be greater than 0",
  "timestamp": "2025-11-16T18:19:14.289823"
}
```

**错误响应 (409 Conflict):**
```json
{
  "status": 409,
  "message": "Template name already exists in this category",
  "timestamp": "2025-11-16T18:19:14.289823"
}
```

---

### 获取分类的所有模板

获取指定分类的所有商品模板。

**权限要求:** 公司成员(ADMIN/MANAGER/MEMBER)

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/product-templates/category/1
```

**路径参数:**
- `categoryId` (必需): 分类ID

**响应 (200 OK):**
```json
[
  {
    "id": 1,
    "name": "iPhone 15 Pro",
    "description": "最新款苹果智能手机",
    "images": [
      "https://example.com/iphone1.jpg",
      "https://example.com/iphone2.jpg"
    ],
    "unit": "件",
    "price": 999.99,
    "currency": "USD",
    "supplier": "Apple Inc",
    "supplierCountry": "USA",
    "barCode": "123456789012",
    "qrCode": "https://example.com/qr.png",
    "categoryId": 1,
    "categoryName": "电子产品",
    "companyId": 1,
    "companyName": "示例公司",
    "creatorEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:19:14.289823",
    "updatedAt": "2025-11-16T18:19:14.289826"
  },
  {
    "id": 2,
    "name": "Samsung Galaxy S24",
    "description": "最新款三星智能手机",
    "images": [
      "https://example.com/samsung1.jpg",
      "https://example.com/samsung2.jpg"
    ],
    "unit": "件",
    "price": 899.99,
    "currency": "USD",
    "supplier": "Samsung Electronics",
    "supplierCountry": "South Korea",
    "barCode": "987654321098",
    "qrCode": "https://example.com/qr2.png",
    "categoryId": 1,
    "categoryName": "电子产品",
    "companyId": 1,
    "companyName": "示例公司",
    "creatorEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:19:29.129894",
    "updatedAt": "2025-11-16T18:19:29.129907"
  }
]
```

---

### 根据ID获取模板

获取指定ID的商品模板详情。

**权限要求:** 公司成员(ADMIN/MANAGER/MEMBER)

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/product-templates/1
```

**路径参数:**
- `id` (必需): 模板ID

**响应 (200 OK):**
```json
{
  "id": 1,
  "name": "iPhone 15 Pro",
  "description": "最新款苹果智能手机",
  "images": [
    "https://example.com/iphone1.jpg",
    "https://example.com/iphone2.jpg"
  ],
  "unit": "件",
  "price": 999.99,
  "currency": "USD",
  "supplier": "Apple Inc",
  "supplierCountry": "USA",
  "barCode": "123456789012",
  "qrCode": "https://example.com/qr.png",
  "categoryId": 1,
  "categoryName": "电子产品",
  "companyId": 1,
  "companyName": "示例公司",
  "creatorEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:19:14.289823",
  "updatedAt": "2025-11-16T18:19:14.289826"
}
```

---

### 获取我创建的所有模板

获取当前用户创建的所有商品模板。

**权限要求:** 登录用户

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/product-templates/my
```

**响应 (200 OK):**
```json
[
  {
    "id": 1,
    "name": "iPhone 15 Pro",
    "description": "最新款苹果智能手机",
    "images": [
      "https://example.com/iphone1.jpg",
      "https://example.com/iphone2.jpg"
    ],
    "unit": "件",
    "price": 999.99,
    "currency": "USD",
    "supplier": "Apple Inc",
    "supplierCountry": "USA",
    "barCode": "123456789012",
    "qrCode": "https://example.com/qr.png",
    "categoryId": 1,
    "categoryName": "电子产品",
    "companyId": 1,
    "companyName": "示例公司",
    "creatorEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:19:14.289823",
    "updatedAt": "2025-11-16T18:19:14.289826"
  }
]
```

---

### 更新模板信息

更新指定ID的商品模板信息。

**权限要求:** ADMIN

**请求:**
```bash
curl -X PUT http://localhost:8080/product-templates/1 \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "iPhone 15 Pro Max",
    "description": "最新款苹果智能手机 - Pro Max版本",
    "images": [
      "https://example.com/iphone-pro-max1.jpg",
      "https://example.com/iphone-pro-max2.jpg"
    ],
    "unit": "件",
    "price": 1099.99,
    "currency": "USD",
    "supplier": "Apple Inc",
    "supplierCountry": "USA",
    "barCode": "123456789012",
    "qrCode": "https://example.com/qr-updated.png",
    "categoryId": 1
  }'
```

**请求体:**
```json
{
  "name": "iPhone 15 Pro Max",
  "description": "最新款苹果智能手机 - Pro Max版本",
  "images": [
    "https://example.com/iphone-pro-max1.jpg",
    "https://example.com/iphone-pro-max2.jpg"
  ],
  "unit": "件",
  "price": 1099.99,
  "currency": "USD",
  "supplier": "Apple Inc",
  "supplierCountry": "USA",
  "barCode": "123456789012",
  "qrCode": "https://example.com/qr-updated.png",
  "categoryId": 1
}
```

**响应 (200 OK):**
```json
{
  "id": 1,
  "name": "iPhone 15 Pro Max",
  "description": "最新款苹果智能手机 - Pro Max版本",
  "images": [
    "https://example.com/iphone-pro-max1.jpg",
    "https://example.com/iphone-pro-max2.jpg"
  ],
  "unit": "件",
  "price": 1099.99,
  "currency": "USD",
  "supplier": "Apple Inc",
  "supplierCountry": "USA",
  "barCode": "123456789012",
  "qrCode": "https://example.com/qr-updated.png",
  "categoryId": 1,
  "categoryName": "电子产品",
  "companyId": 1,
  "companyName": "示例公司",
  "creatorEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:19:14.289823",
  "updatedAt": "2025-11-16T18:20:00.000000"
}
```

---

### 删除模板

删除指定ID的商品模板。

**权限要求:** ADMIN

**请求:**
```bash
curl -X DELETE http://localhost:8080/product-templates/1 \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**路径参数:**
- `id` (必需): 模板ID

**响应 (204 No Content)**

**错误响应 (404 Not Found):**
```json
{
  "status": 404,
  "message": "Product template not found: 1",
  "timestamp": "2025-11-16T18:19:14.289823"
}
```

---

## 完整API测试流程

### 完整商品管理流程: 创建分类 → 创建模板 → 查询 → 更新 → 删除

#### 1. 登录获取Token

```bash
curl -X POST http://localhost:8080/api/users/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "password": "Password123"
  }'
```

**保存返回的Token供后续使用**

---

#### 2. 创建商品分类

```bash
TOKEN="your_token_here"

curl -X POST http://localhost:8080/product-categories \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "电子产品",
    "description": "各类电子产品和配件",
    "image": "https://example.com/electronics.jpg",
    "companyId": 1
  }'
```

**预期输出:**
```json
{
  "id": 1,
  "name": "电子产品",
  "description": "各类电子产品和配件",
  "image": "https://example.com/electronics.jpg",
  "companyId": 1,
  "companyName": "示例公司",
  "creatorEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:09:35.079708",
  "updatedAt": "2025-11-16T18:09:35.079712"
}
```

**保存分类ID: `1`**

---

#### 3. 创建第二个分类

```bash
curl -X POST http://localhost:8080/product-categories \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "服装",
    "description": "衣服和配饰",
    "image": "https://example.com/clothing.jpg",
    "companyId": 1
  }'
```

---

#### 4. 获取公司的所有分类

```bash
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8080/product-categories/company/1
```

**预期输出:** 包含2个分类的数组

---

#### 5. 创建商品模板

```bash
curl -X POST http://localhost:8080/product-templates \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "iPhone 15 Pro",
    "description": "最新款苹果智能手机",
    "images": [
      "https://example.com/iphone1.jpg",
      "https://example.com/iphone2.jpg"
    ],
    "unit": "件",
    "price": 999.99,
    "currency": "USD",
    "supplier": "Apple Inc",
    "supplierCountry": "USA",
    "barCode": "123456789012",
    "qrCode": "https://example.com/qr.png",
    "categoryId": 1
  }'
```

**预期输出:**
```json
{
  "id": 1,
  "name": "iPhone 15 Pro",
  "description": "最新款苹果智能手机",
  "images": [
    "https://example.com/iphone1.jpg",
    "https://example.com/iphone2.jpg"
  ],
  "unit": "件",
  "price": 999.99,
  "currency": "USD",
  "supplier": "Apple Inc",
  "supplierCountry": "USA",
  "barCode": "123456789012",
  "qrCode": "https://example.com/qr.png",
  "categoryId": 1,
  "categoryName": "电子产品",
  "companyId": 1,
  "companyName": "示例公司",
  "creatorEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:19:14.289823",
  "updatedAt": "2025-11-16T18:19:14.289826"
}
```

**保存模板ID: `1`**

---

#### 6. 创建第二个模板

```bash
curl -X POST http://localhost:8080/product-templates \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Samsung Galaxy S24",
    "description": "最新款三星智能手机",
    "images": [
      "https://example.com/samsung1.jpg",
      "https://example.com/samsung2.jpg"
    ],
    "unit": "件",
    "price": 899.99,
    "currency": "USD",
    "supplier": "Samsung Electronics",
    "supplierCountry": "South Korea",
    "barCode": "987654321098",
    "qrCode": "https://example.com/qr2.png",
    "categoryId": 1
  }'
```

---

#### 7. 获取分类的所有模板

```bash
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8080/product-templates/category/1
```

**预期输出:** 包含2个模板的数组

---

#### 8. 获取单个模板

```bash
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8080/product-templates/1
```

---

#### 9. 更新模板信息

```bash
curl -X PUT http://localhost:8080/product-templates/1 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "iPhone 15 Pro Max",
    "description": "最新款苹果智能手机 - Pro Max版本",
    "images": [
      "https://example.com/iphone-pro-max1.jpg",
      "https://example.com/iphone-pro-max2.jpg"
    ],
    "unit": "件",
    "price": 1099.99,
    "currency": "USD",
    "supplier": "Apple Inc",
    "supplierCountry": "USA",
    "barCode": "123456789012",
    "qrCode": "https://example.com/qr-updated.png",
    "categoryId": 1
  }'
```

**预期输出:** 更新后的模板信息

---

#### 10. 更新分类信息

```bash
curl -X PUT http://localhost:8080/product-categories/1 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "电子产品和配件",
    "description": "更新后的描述",
    "image": "https://example.com/electronics-updated.jpg",
    "companyId": 1
  }'
```

---

#### 11. 删除模板

```bash
curl -X DELETE http://localhost:8080/product-templates/1 \
  -H "Authorization: Bearer $TOKEN"
```

**预期输出:** 204 No Content

---

#### 12. 删除分类

```bash
curl -X DELETE http://localhost:8080/product-categories/1 \
  -H "Authorization: Bearer $TOKEN"
```

**预期输出:** 204 No Content

---

## 错误处理

### 常见错误响应

#### 400 Bad Request - 验证错误

```json
{
  "status": 400,
  "message": "Validation failed: Category name must be between 2-200 characters",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

**常见验证错误:**
- 分类名称长度不符合要求
- 模板名称长度不符合要求
- 价格必须大于0
- 必需字段缺失

---

#### 404 Not Found

```json
{
  "status": 404,
  "message": "Product category not found: 1",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

**常见404错误:**
- 分类不存在
- 模板不存在
- 公司不存在

---

#### 409 Conflict - 名称已存在

```json
{
  "status": 409,
  "message": "Category name already exists in this company",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

**常见冲突错误:**
- 分类名称在公司内已存在
- 模板名称在分类内已存在

---

#### 403 Forbidden - 权限不足

```json
{
  "status": 403,
  "message": "You don't have permission to access this company",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

**常见权限错误:**
- 用户不是ADMIN
- 用户不是公司成员

---

## 权限控制

### 商品分类权限

| 操作 | ADMIN | MANAGER | MEMBER |
|------|-------|---------|--------|
| 创建分类 | ✅ | ❌ | ❌ |
| 查看分类 | ✅ | ✅ | ✅ |
| 更新分类 | ✅ | ❌ | ❌ |
| 删除分类 | ✅ | ❌ | ❌ |

### 商品模板权限

| 操作 | ADMIN | MANAGER | MEMBER |
|------|-------|---------|--------|
| 创建模板 | ✅ | ❌ | ❌ |
| 查看模板 | ✅ | ✅ | ✅ |
| 更新模板 | ✅ | ❌ | ❌ |
| 删除模板 | ✅ | ❌ | ❌ |

---

## 数据关系

### 数据结构

```
公司 (Company)
  └── 商品分类 (ProductCategory)
        ├── 分类名称 (name)
        ├── 分类描述 (description)
        ├── 分类图片 (image)
        └── 商品模板 (ProductTemplate)
              ├── 模板名称 (name)
              ├── 模板描述 (description)
              ├── 商品图片 (images) - 支持多张
              ├── 单位 (unit)
              ├── 价格 (price)
              ├── 货币单位 (currency)
              ├── 供应商 (supplier)
              ├── 供应商国家 (supplierCountry)
              ├── 条形码 (barCode)
              └── 二维码 (qrCode)
```

### 关键字段说明

#### 商品分类字段

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Long | 分类ID(自动生成) |
| name | String | 分类名称(公司内唯一) |
| description | String | 分类描述 |
| image | String | 分类图片URL |
| companyId | Long | 所属公司ID |
| companyName | String | 公司名称(自动关联) |
| creatorEmail | String | 创建者邮箱 |
| createdAt | DateTime | 创建时间 |
| updatedAt | DateTime | 更新时间 |

#### 商品模板字段

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Long | 模板ID(自动生成) |
| name | String | 模板名称(分类内唯一) |
| description | String | 模板描述 |
| images | Array[String] | 图片URL列表(支持多张) |
| unit | String | 单位 |
| price | BigDecimal | 价格 |
| currency | String | 货币单位 |
| supplier | String | 供应商 |
| supplierCountry | String | 供应商所在国家 |
| barCode | String | 条形码 |
| qrCode | String | 二维码 |
| categoryId | Long | 所属分类ID |
| categoryName | String | 分类名称(自动关联) |
| companyId | Long | 公司ID(自动关联) |
| companyName | String | 公司名称(自动关联) |
| creatorEmail | String | 创建者邮箱 |
| createdAt | DateTime | 创建时间 |
| updatedAt | DateTime | 更新时间 |

---

## 测试清单

### 商品分类测试

- [ ] 成功创建商品分类
- [ ] 验证分类名称长度限制
- [ ] 验证分类名称唯一性
- [ ] 成功获取公司的所有分类
- [ ] 成功获取单个分类
- [ ] 成功获取我创建的所有分类
- [ ] 成功更新分类信息
- [ ] 成功删除分类
- [ ] 验证权限控制(非ADMIN不能操作)

### 商品模板测试

- [ ] 成功创建商品模板
- [ ] 验证模板名称长度限制
- [ ] 验证模板名称唯一性
- [ ] 验证价格必须大于0
- [ ] 成功上传多张图片
- [ ] 成功获取分类的所有模板
- [ ] 成功获取单个模板
- [ ] 成功获取我创建的所有模板
- [ ] 成功更新模板信息
- [ ] 成功删除模板
- [ ] 验证权限控制(非ADMIN不能操作)

---

## 有用的链接

- **API文档**: http://localhost:8080/api/swagger-ui.html
- **OpenAPI规范**: http://localhost:8080/api/v3/api-docs
- **H2数据库控制台**: http://localhost:8080/api/h2-console

---

## 支持

如有问题或疑问:
1. 检查响应中的错误消息
2. 查看每个端点的验证规则
3. 确保提供了所有必需字段
4. 验证用户权限是否足够
5. 检查分类/模板名称是否唯一
6. 确保价格格式正确

---

**最后更新:** 2025-11-16
**API版本:** 1.0.0
