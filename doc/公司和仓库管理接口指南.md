# 集群和仓库管理接口指南
集群创建、管理和仓库(Stoq)创建、管理的完整指南。

## 目录

1. [概览](#概览)
2. [集群管理](#集群管理)
3. [仓库管理](#仓库管理)
4. [完整API测试流程](#完整api测试流程)
5. [错误处理](#错误处理)
6. [权限控制](#权限控制)
7. [数据关系](#数据关系)

---

## 概览

Stoq API提供了完整的集群和仓库管理系统,具有以下特性:

- ✅ 用户创建集群(自动成为ADMIN)
- ✅ 集群成员管理(ADMIN/MANAGER/MEMBER)
- ✅ 在集群中创建仓库(Stoq)
- ✅ 仓库详细信息管理
- ✅ 基于角色的权限控制
- ✅ 集群名称和仓库名称唯一性验证

### 主要端点

#### 集群端点

| 方法 | 端点 | 说明 |
|------|------|------|
| POST | `/clusters` | 创建集群 |
| GET | `/clusters` | 获取所有集群 |
| GET | `/clusters/{id}` | 根据ID获取集群 |
| GET | `/clusters/my` | 获取我创建的所有集群 |
| PUT | `/clusters/{id}` | 更新集群信息 |
| DELETE | `/clusters/{id}` | 删除集群 |

#### 仓库端点

| 方法 | 端点 | 说明 |
|------|------|------|
| POST | `/stoqs` | 创建仓库 |
| GET | `/stoqs/cluster/{clusterId}` | 获取集群的所有仓库 |
| GET | `/stoqs/{id}` | 根据ID获取仓库 |
| GET | `/stoqs/my` | 获取我创建的所有仓库 |
| PUT | `/stoqs/{id}` | 更新仓库信息 |
| DELETE | `/stoqs/{id}` | 删除仓库 |

---

## 集群管理

### 创建集群

创建一个新的集群。创建者自动成为该集群的ADMIN。

**权限要求:** 登录用户

**请求:**
```bash
curl -X POST http://localhost:8080/api/clusters \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "示例集群",
    "logo": "https://example.com/logo.png",
    "address": "北京市朝阳区123号",
    "countryId": 1,
    "city": "北京",
    "field": "科技",
    "employeeCount": 50,
    "type": "PROFESSIONAL",
    "registrationNumber": "REG-2024-001"
  }'
```

**请求体:**
```json
{
  "name": "示例集群",
  "logo": "https://example.com/logo.png",
  "address": "北京市朝阳区123号",
  "countryId": 1,
  "city": "北京",
  "field": "科技",
  "employeeCount": 50,
  "type": "PROFESSIONAL",
  "registrationNumber": "REG-2024-001"
}
```

**字段说明:**

| 字段 | 类型 | 必需 | 说明 |
|------|------|------|------|
| name | String | ✅ | 集群名称(2-200字符) |
| logo | String | ❌ | 集群logo URL |
| address | String | ✅ | 集群地址(2-500字符) |
| countryId | Long | ✅ | 国家ID |
| city | String | ✅ | 城市(2-100字符) |
| field | String | ✅ | 行业领域(2-100字符) |
| employeeCount | Integer | ✅ | 员工数量(1-1000000) |
| type | String | ✅ | 集群类型(PROFESSIONAL/INDIVIDUAL/STARTUP等) |
| registrationNumber | String | ✅ | 注册号(2-100字符) |

**验证规则:**
- 集群名称长度必须在2-200个字符之间
- 地址长度必须在2-500个字符之间
- 城市长度必须在2-100个字符之间
- 行业领域长度必须在2-100个字符之间
- 员工数量必须在1-1000000之间
- 注册号长度必须在2-100个字符之间
- 国家ID必须存在

**响应 (201 Created):**
```json
{
  "id": 1,
  "name": "示例集群",
  "logo": "https://example.com/logo.png",
  "address": "北京市朝阳区123号",
  "countryId": 1,
  "city": "北京",
  "field": "科技",
  "employeeCount": 50,
  "type": "PROFESSIONAL",
  "registrationNumber": "REG-2024-001",
  "ownerEmail": "test@example.com",
  "createdAt": "2025-11-16T21:59:57.927424",
  "updatedAt": "2025-11-16T21:59:57.927434"
}
```

**错误响应 (400 Bad Request):**
```json
{
  "status": 400,
  "message": "Validation failed: Cluster name must be between 2-200 characters",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

---

### 获取所有集群

获取当前用户所属的所有集群。

**权限要求:** 登录用户

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/clusters
```

**响应 (200 OK):**
```json
[
  {
    "id": 1,
    "name": "示例集群",
    "logo": "https://example.com/logo.png",
    "address": "北京市朝阳区123号",
    "countryId": 1,
    "city": "北京",
    "field": "科技",
    "employeeCount": 50,
    "type": "PROFESSIONAL",
    "registrationNumber": "REG-2024-001",
    "ownerEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:09:35.079708",
    "updatedAt": "2025-11-16T18:09:35.079712"
  },
  {
    "id": 2,
    "name": "另一个集群",
    "logo": "https://example.com/logo2.png",
    "address": "上海市浦东新区456号",
    "countryId": 1,
    "city": "上海",
    "field": "金融",
    "employeeCount": 100,
    "type": "PROFESSIONAL",
    "registrationNumber": "REG-2024-002",
    "ownerEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:10:00.000000",
    "updatedAt": "2025-11-16T18:10:00.000000"
  }
]
```

---

### 根据ID获取集群

获取指定ID的集群详情。

**权限要求:** 集群成员(ADMIN/MANAGER/MEMBER)

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/clusters/1
```

**路径参数:**
- `id` (必需): 集群ID

**响应 (200 OK):**
```json
{
  "id": 1,
  "name": "示例集群",
  "logo": "https://example.com/logo.png",
  "address": "北京市朝阳区123号",
  "countryId": 1,
  "city": "北京",
  "field": "科技",
  "employeeCount": 50,
  "type": "PROFESSIONAL",
  "registrationNumber": "REG-2024-001",
  "ownerEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:09:35.079708",
  "updatedAt": "2025-11-16T18:09:35.079712"
}
```

**错误响应 (404 Not Found):**
```json
{
  "status": 404,
  "message": "Cluster not found: 1",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

---

### 获取我创建的所有集群

获取当前用户创建的所有集群。

**权限要求:** 登录用户

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/clusters/my
```

**响应 (200 OK):**
```json
[
  {
    "id": 1,
    "name": "示例集群",
    "logo": "https://example.com/logo.png",
    "address": "北京市朝阳区123号",
    "countryId": 1,
    "city": "北京",
    "field": "科技",
    "employeeCount": 50,
    "type": "PROFESSIONAL",
    "registrationNumber": "REG-2024-001",
    "ownerEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:09:35.079708",
    "updatedAt": "2025-11-16T18:09:35.079712"
  }
]
```

---

### 更新集群信息

更新指定ID的集群信息。

**权限要求:** ADMIN

**请求:**
```bash
curl -X PUT http://localhost:8080/clusters/1 \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "更新后的集群名称",
    "logo": "https://example.com/logo-updated.png",
    "address": "北京市朝阳区789号",
    "countryId": 1,
    "city": "北京",
    "field": "科技和创新",
    "employeeCount": 100,
    "type": "PROFESSIONAL",
    "registrationNumber": "REG-2024-001-UPDATED"
  }'
```

**请求体:**
```json
{
  "name": "更新后的集群名称",
  "logo": "https://example.com/logo-updated.png",
  "address": "北京市朝阳区789号",
  "countryId": 1,
  "city": "北京",
  "field": "科技和创新",
  "employeeCount": 100,
  "type": "PROFESSIONAL",
  "registrationNumber": "REG-2024-001-UPDATED"
}
```

**响应 (200 OK):**
```json
{
  "id": 1,
  "name": "更新后的集群名称",
  "logo": "https://example.com/logo-updated.png",
  "address": "北京市朝阳区789号",
  "countryId": 1,
  "city": "北京",
  "field": "科技和创新",
  "employeeCount": 100,
  "type": "PROFESSIONAL",
  "registrationNumber": "REG-2024-001-UPDATED",
  "ownerEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:09:35.079708",
  "updatedAt": "2025-11-16T18:10:00.000000"
}
```

---

### 删除集群

删除指定ID的集群。

**权限要求:** ADMIN

**请求:**
```bash
curl -X DELETE http://localhost:8080/clusters/1 \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**路径参数:**
- `id` (必需): 集群ID

**响应 (204 No Content)**

**错误响应 (404 Not Found):**
```json
{
  "status": 404,
  "message": "Cluster not found: 1",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

---

## 仓库管理

### 创建仓库

在指定集群中创建一个新的仓库(Stoq)。

**权限要求:** ADMIN

**请求:**
```bash
curl -X POST http://localhost:8080/stoqs \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "北京仓库",
    "description": "集群主要仓库",
    "location": "北京市朝阳区",
    "capacity": 10000,
    "manager": "张三",
    "phone": "+86 13800000001",
    "email": "warehouse@example.com",
    "clusterId": 1
  }'
```

**请求体:**
```json
{
  "name": "北京仓库",
  "description": "集群主要仓库",
  "administrator": "张三",
  "clusterId": 1
}
```

**字段说明:**

| 字段 | 类型 | 必需 | 说明 |
|------|------|------|------|
| name | String | ✅ | 仓库名称(2-200字符) |
| description | String | ❌ | 仓库描述(最多1000字符) |
| administrator | String | ✅ | 仓库管理员(2-100字符) |
| clusterId | Long | ✅ | 所属集群ID |

**验证规则:**
- 仓库名称长度必须在2-200个字符之间
- 管理员名称长度必须在2-100个字符之间
- 集群必须存在
- 用户必须是该集群的所有者(owner)

**响应 (201 Created):**
```json
{
  "id": 1,
  "name": "北京仓库",
  "description": "集群主要仓库",
  "administrator": "张三",
  "clusterId": 1,
  "clusterName": "示例集群",
  "creatorEmail": "test@example.com",
  "createdAt": "2025-11-16T22:00:03.336092",
  "updatedAt": "2025-11-16T22:00:03.336103"
}
```

**错误响应 (400 Bad Request):**
```json
{
  "status": 400,
  "message": "Validation failed: Warehouse name must be between 2-200 characters",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

**错误响应 (400 Bad Request):**
```json
{
  "status": 400,
  "message": "Validation failed: Stoq name must be between 2-200 characters",
  "timestamp": "2025-11-16T22:00:00.000000"
}
```

---

### 获取集群的所有仓库

获取指定集群的所有仓库。

**权限要求:** 集群成员(ADMIN/MANAGER/MEMBER)

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/stoqs/cluster/1
```

**路径参数:**
- `clusterId` (必需): 集群ID

**响应 (200 OK):**
```json
[
  {
    "id": 1,
    "name": "北京仓库",
    "description": "集群主要仓库",
    "location": "北京市朝阳区",
    "capacity": 10000,
    "manager": "张三",
    "phone": "+86 13800000001",
    "email": "warehouse@example.com",
    "clusterId": 1,
    "clusterName": "示例集群",
    "ownerEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:09:35.079708",
    "updatedAt": "2025-11-16T18:09:35.079712"
  },
  {
    "id": 2,
    "name": "上海仓库",
    "description": "上海分集群仓库",
    "location": "上海市浦东新区",
    "capacity": 5000,
    "manager": "李四",
    "phone": "+86 13800000002",
    "email": "warehouse-sh@example.com",
    "clusterId": 1,
    "clusterName": "示例集群",
    "ownerEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:10:00.000000",
    "updatedAt": "2025-11-16T18:10:00.000000"
  }
]
```

---

### 根据ID获取仓库

获取指定ID的仓库详情。

**权限要求:** 集群成员(ADMIN/MANAGER/MEMBER)

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/stoqs/1
```

**路径参数:**
- `id` (必需): 仓库ID

**响应 (200 OK):**
```json
{
  "id": 1,
  "name": "北京仓库",
  "description": "集群主要仓库",
  "location": "北京市朝阳区",
  "capacity": 10000,
  "manager": "张三",
  "phone": "+86 13800000001",
  "email": "warehouse@example.com",
  "clusterId": 1,
  "clusterName": "示例集群",
  "ownerEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:09:35.079708",
  "updatedAt": "2025-11-16T18:09:35.079712"
}
```

**错误响应 (404 Not Found):**
```json
{
  "status": 404,
  "message": "Stoq not found: 1",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

---

### 获取我创建的所有仓库

获取当前用户创建的所有仓库。

**权限要求:** 登录用户

**请求:**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  http://localhost:8080/stoqs/my
```

**响应 (200 OK):**
```json
[
  {
    "id": 1,
    "name": "北京仓库",
    "description": "集群主要仓库",
    "location": "北京市朝阳区",
    "capacity": 10000,
    "manager": "张三",
    "phone": "+86 13800000001",
    "email": "warehouse@example.com",
    "clusterId": 1,
    "clusterName": "示例集群",
    "ownerEmail": "admin@example.com",
    "createdAt": "2025-11-16T18:09:35.079708",
    "updatedAt": "2025-11-16T18:09:35.079712"
  }
]
```

---

### 更新仓库信息

更新指定ID的仓库信息。

**权限要求:** ADMIN

**请求:**
```bash
curl -X PUT http://localhost:8080/stoqs/1 \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "北京仓库-更新",
    "description": "更新后的仓库描述",
    "location": "北京市朝阳区新地址",
    "capacity": 15000,
    "manager": "王五",
    "phone": "+86 13800000003",
    "email": "warehouse-new@example.com",
    "clusterId": 1
  }'
```

**请求体:**
```json
{
  "name": "北京仓库-更新",
  "description": "更新后的仓库描述",
  "location": "北京市朝阳区新地址",
  "capacity": 15000,
  "manager": "王五",
  "phone": "+86 13800000003",
  "email": "warehouse-new@example.com",
  "clusterId": 1
}
```

**响应 (200 OK):**
```json
{
  "id": 1,
  "name": "北京仓库-更新",
  "description": "更新后的仓库描述",
  "location": "北京市朝阳区新地址",
  "capacity": 15000,
  "manager": "王五",
  "phone": "+86 13800000003",
  "email": "warehouse-new@example.com",
  "clusterId": 1,
  "clusterName": "示例集群",
  "ownerEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:09:35.079708",
  "updatedAt": "2025-11-16T18:10:00.000000"
}
```

---

### 删除仓库

删除指定ID的仓库。

**权限要求:** ADMIN

**请求:**
```bash
curl -X DELETE http://localhost:8080/stoqs/1 \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**路径参数:**
- `id` (必需): 仓库ID

**响应 (204 No Content)**

**错误响应 (404 Not Found):**
```json
{
  "status": 404,
  "message": "Stoq not found: 1",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

---

## 完整API测试流程

### 完整集群和仓库管理流程: 创建集群 → 创建仓库 → 查询 → 更新 → 删除

#### 1. 登录获取Token

```bash
curl -X POST http://localhost:8080/api/users/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "password": "Password123"
  }'
```

**保存返回的Token供后续使用**

---

#### 2. 创建集群

```bash
TOKEN="your_token_here"

curl -X POST http://localhost:8080/clusters \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "示例集群",
    "logo": "https://example.com/logo.png",
    "address": "北京市朝阳区123号",
    "countryId": 1,
    "city": "北京",
    "field": "科技",
    "employeeCount": 50,
    "type": "PROFESSIONAL",
    "registrationNumber": "REG-2024-001"
  }'
```

**预期输出:**
```json
{
  "id": 1,
  "name": "示例集群",
  "logo": "https://example.com/logo.png",
  "address": "北京市朝阳区123号",
  "countryId": 1,
  "city": "北京",
  "field": "科技",
  "employeeCount": 50,
  "type": "PROFESSIONAL",
  "registrationNumber": "REG-2024-001",
  "ownerEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:09:35.079708",
  "updatedAt": "2025-11-16T18:09:35.079712"
}
```

**保存集群ID: `1`**

---

#### 3. 创建第二个集群

```bash
curl -X POST http://localhost:8080/clusters \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "另一个集群",
    "logo": "https://example.com/logo2.png",
    "address": "上海市浦东新区456号",
    "countryId": 1,
    "city": "上海",
    "field": "金融",
    "employeeCount": 100,
    "type": "PROFESSIONAL",
    "registrationNumber": "REG-2024-002"
  }'
```

---

#### 4. 获取所有集群

```bash
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8080/clusters
```

**预期输出:** 包含2个集群的数组

---

#### 5. 获取单个集群

```bash
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8080/clusters/1
```

---

#### 6. 创建仓库

```bash
curl -X POST http://localhost:8080/stoqs \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "北京仓库",
    "description": "集群主要仓库",
    "location": "北京市朝阳区",
    "capacity": 10000,
    "manager": "张三",
    "phone": "+86 13800000001",
    "email": "warehouse@example.com",
    "clusterId": 1
  }'
```

**预期输出:**
```json
{
  "id": 1,
  "name": "北京仓库",
  "description": "集群主要仓库",
  "location": "北京市朝阳区",
  "capacity": 10000,
  "manager": "张三",
  "phone": "+86 13800000001",
  "email": "warehouse@example.com",
  "clusterId": 1,
  "clusterName": "示例集群",
  "ownerEmail": "admin@example.com",
  "createdAt": "2025-11-16T18:09:35.079708",
  "updatedAt": "2025-11-16T18:09:35.079712"
}
```

**保存仓库ID: `1`**

---

#### 7. 创建第二个仓库

```bash
curl -X POST http://localhost:8080/stoqs \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "上海仓库",
    "description": "上海分集群仓库",
    "location": "上海市浦东新区",
    "capacity": 5000,
    "manager": "李四",
    "phone": "+86 13800000002",
    "email": "warehouse-sh@example.com",
    "clusterId": 1
  }'
```

---

#### 8. 获取集群的所有仓库

```bash
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8080/stoqs/cluster/1
```

**预期输出:** 包含2个仓库的数组

---

#### 9. 获取单个仓库

```bash
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8080/stoqs/1
```

---

#### 10. 更新仓库信息

```bash
curl -X PUT http://localhost:8080/stoqs/1 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "北京仓库-更新",
    "description": "更新后的仓库描述",
    "location": "北京市朝阳区新地址",
    "capacity": 15000,
    "manager": "王五",
    "phone": "+86 13800000003",
    "email": "warehouse-new@example.com",
    "clusterId": 1
  }'
```

**预期输出:** 更新后的仓库信息

---

#### 11. 更新集群信息

```bash
curl -X PUT http://localhost:8080/clusters/1 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "更新后的集群名称",
    "logo": "https://example.com/logo-updated.png",
    "address": "北京市朝阳区789号",
    "countryId": 1,
    "city": "北京",
    "field": "科技和创新",
    "employeeCount": 100,
    "type": "PROFESSIONAL",
    "registrationNumber": "REG-2024-001-UPDATED"
  }'
```

**预期输出:** 更新后的集群信息

---

#### 12. 获取我创建的所有仓库

```bash
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8080/stoqs/my
```

---

#### 13. 获取我创建的所有集群

```bash
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8080/clusters/my
```

---

#### 14. 删除仓库

```bash
curl -X DELETE http://localhost:8080/stoqs/1 \
  -H "Authorization: Bearer $TOKEN"
```

**预期输出:** 204 No Content

---

#### 15. 删除集群

```bash
curl -X DELETE http://localhost:8080/clusters/1 \
  -H "Authorization: Bearer $TOKEN"
```

**预期输出:** 204 No Content

---

## 错误处理

### 常见错误响应

#### 400 Bad Request - 验证错误

```json
{
  "status": 400,
  "message": "Validation failed: Cluster name must be between 2-200 characters",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

**常见验证错误:**
- 集群名称长度不符合要求
- 仓库名称长度不符合要求
- 容量必须在有效范围内
- 必需字段缺失
- 邮箱格式不正确

---

#### 404 Not Found

```json
{
  "status": 404,
  "message": "Cluster not found: 1",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

**常见404错误:**
- 集群不存在
- 仓库不存在

---

#### 409 Conflict - 名称已存在

```json
{
  "status": 409,
  "message": "Warehouse name already exists in this cluster",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

**常见冲突错误:**
- 仓库名称在集群内已存在

---

#### 403 Forbidden - 权限不足

```json
{
  "status": 403,
  "message": "You don't have permission to access this cluster",
  "timestamp": "2025-11-16T18:09:35.079708"
}
```

**常见权限错误:**
- 用户不是ADMIN
- 用户不是集群成员

---

## 权限控制

### 集群权限

| 操作 | ADMIN | MANAGER | MEMBER |
|------|-------|---------|--------|
| 创建集群 | ✅ | ❌ | ❌ |
| 查看集群 | ✅ | ✅ | ✅ |
| 更新集群 | ✅ | ❌ | ❌ |
| 删除集群 | ✅ | ❌ | ❌ |

### 仓库权限

| 操作 | ADMIN | MANAGER | MEMBER |
|------|-------|---------|--------|
| 创建仓库 | ✅ | ❌ | ❌ |
| 查看仓库 | ✅ | ✅ | ✅ |
| 更新仓库 | ✅ | ❌ | ❌ |
| 删除仓库 | ✅ | ❌ | ❌ |

---

## 数据关系

### 数据结构

```
用户 (User)
  └── 集群 (Cluster)
        ├── 集群名称 (name)
        ├── 集群logo (logo)
        ├── 集群地址 (address)
        ├── 员工数量 (employeeCount)
        ├── 集群类型 (type)
        ├── 注册号 (registrationNumber)
        ├── 集群成员 (ClusterMember)
        │     └── 角色 (role): ADMIN/MANAGER/MEMBER
        └── 仓库 (Stoq)
              ├── 仓库名称 (name)
              ├── 仓库描述 (description)
              ├── 仓库位置 (location)
              ├── 仓库容量 (capacity)
              ├── 仓库管理员 (manager)
              ├── 联系电话 (phone)
              └── 联系邮箱 (email)
```

### 关键字段说明

#### 集群字段

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Long | 集群ID(自动生成) |
| name | String | 集群名称 |
| logo | String | 集群logo URL |
| address | String | 集群地址 |
| countryId | Long | 国家ID |
| city | String | 城市 |
| field | String | 行业领域 |
| employeeCount | Integer | 员工数量 |
| type | String | 集群类型 |
| registrationNumber | String | 注册号 |
| ownerEmail | String | 创建者邮箱 |
| createdAt | DateTime | 创建时间 |
| updatedAt | DateTime | 更新时间 |

#### 仓库字段

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Long | 仓库ID(自动生成) |
| name | String | 仓库名称(集群内唯一) |
| description | String | 仓库描述 |
| location | String | 仓库位置 |
| capacity | Integer | 仓库容量 |
| manager | String | 仓库管理员 |
| phone | String | 联系电话 |
| email | String | 联系邮箱 |
| clusterId | Long | 所属集群ID |
| clusterName | String | 集群名称(自动关联) |
| ownerEmail | String | 创建者邮箱 |
| createdAt | DateTime | 创建时间 |
| updatedAt | DateTime | 更新时间 |

---

## 测试清单

### 集群测试

- [ ] 成功创建集群
- [ ] 验证集群名称长度限制
- [ ] 成功获取所有集群
- [ ] 成功获取单个集群
- [ ] 成功获取我创建的所有集群
- [ ] 成功更新集群信息
- [ ] 成功删除集群
- [ ] 验证权限控制(非ADMIN不能操作)

### 仓库测试

- [ ] 成功创建仓库
- [ ] 验证仓库名称长度限制
- [ ] 验证仓库名称唯一性
- [ ] 验证容量范围限制
- [ ] 验证邮箱格式
- [ ] 成功获取集群的所有仓库
- [ ] 成功获取单个仓库
- [ ] 成功获取我创建的所有仓库
- [ ] 成功更新仓库信息
- [ ] 成功删除仓库
- [ ] 验证权限控制(非ADMIN不能操作)

---

## 有用的链接

- **API文档**: http://localhost:8080/api/swagger-ui.html
- **OpenAPI规范**: http://localhost:8080/api/v3/api-docs
- **H2数据库控制台**: http://localhost:8080/api/h2-console

---

## 支持

如有问题或疑问:
1. 检查响应中的错误消息
2. 查看每个端点的验证规则
3. 确保提供了所有必需字段
4. 验证用户权限是否足够
5. 检查集群/仓库名称是否唯一
6. 确保邮箱和电话格式正确

---

## 测试状态

✅ **所有接口已通过完整测试 (2025-11-16)**

| 功能模块 | 测试用例数 | 通过 | 失败 | 通过率 |
|---------|-----------|------|------|--------|
| 集群管理 | 8 | 8 | 0 | 100% |
| 仓库管理 | 8 | 8 | 0 | 100% |
| **总计** | **16** | **16** | **0** | **100%** |

**详细测试报告:** 请查看 `测试报告-集群和仓库管理.md`

**测试脚本:** `test-cluster-stoq.sh`

---

**最后更新:** 2025-11-16 22:00:00  
**最后测试:** 2025-11-16 22:00:00  
**API版本:** 1.0.0
